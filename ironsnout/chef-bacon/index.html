<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="pragma" content="no-cache"/>
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name ="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta charset="utf-8"/>

        <title>Bacon Cook by SnoutUp</title>
		
	<script src="./sdk/codea.js"></script>
	<script src="./sdk/sdk.js"></script>
        
		<script>
			document.addEventListener('touchstart', e => {
				e.preventDefault();
				}, {passive: false})
		</script>	
		
        <style>
            html {
                height: 100%;
                width: 100%;
            }
            
            body {
				background: #5c8332;
				color:#cccccc;
				margin: 0px;
				padding: 0px;
				border: 0px;
				overflow:hidden;

				width: 100%;
				height:100%;
			  
				background-color:#5c8332;
				background-image: url('html5game/bg.webp');
				background-repeat: repeat-x repeat-y;
				background-position: center 0;
				background-size: auto auto;
            }
			
			#decor { 
				position:fixed;
				width: 70%;
				bottom:45%;
				left:50%;
				transform: translate(-50%, 0%);				
				
				max-height:250px;
				max-width:250px;
				object-fit:contain;
				
				animation: anim-scale-pulse 1s linear infinite;	
			}
			
			#decor-hands { 
				position:fixed;
				width: 70%;
				bottom:52%;
				left:50%;
				transform: translate(-50%, 0%);				
				
				max-height:30px;
				max-width:160px;
				object-fit:contain;
				
				animation: anim-hand-wiggle 1s linear infinite;	
				
				margin-left:30px;
			}	
			
			.piles {
				width:117px;
				height:54px;
				position:absolute; 
				background-image: url('html5game/shadow.png');
				background-position: center 0;
				background-size: auto auto;				
			}
			
			#pile1 {
				left:10%;
				bottom:40%;		
			}
			
			#pile2 {
				right:10%;
				bottom:50%;		
				z-index:-100;				
			}
				
			
			#pile3 {
				right:40%;
				bottom:70%;	
				z-index:-100;		
			}
			
			#pile4 {
				left:30%;
				bottom:5%;	
				z-index:100;		
			}			
								
			
			#coin {
				position:absolute;
				display:none;
				
				width:85px;
				height:65px;
				background-image: url('html5game/coin.png');
			}

			#apples {
				width:274px;
				height:276px;
				position:absolute; 
				left:50%;
				bottom:47%;

					
				margin-top:0px;
			}	
			
			#apples-img {
				transform: translate(-50%, 0%);			
				with:274px;
				height:276px;		
				position:absolute;	
				
				margin-left: -100px;
				margin-top: -50px;					
			}	

			@keyframes anim-hand-wiggle {
				0% {
					 transform: translate(-50%, 0%);	
				}

				50% {
					 transform: translate(-50%, -60%);	
				}

				100% {
					transform: translate(-50%, 0%);	
				}
			}			
			
			
			@keyframes anim-scale-pulse {
				0% {
					 transform: translate(-50%, 0%) scale(1, 1) ;
				}

				50% {
					 transform: translate(-50%, 0%) scale(1.02, 1.02) ;
				}

				100% {
					transform: translate(-50%, 0%) scale(1, 1);
				}
			}				
			
			#bar {
				position:fixed;
				width:50%;
				left:0;
				right:0;
				margin:0 auto;
				padding:8px;
				height: 50px;
				top:60%;
				background:#5a3a32;
				z-index:-9999;
				
				border-radius: 20px;				
			}
			
			#fill {
				position:relative;
				width:5%;
				background-color:#ffffff;
				height:50px;
				margin:0px;
				
				border-radius: 15px;
				
				background: #ff0000;
				background: linear-gradient(
					to right,
					#ff0000,#fdcf58
				);			
			}
			
			.pulsating { 
				animation: anim-pulse 1s ease-in-out infinite;	
			}
		
			#proc {
				position:fixed;
				
				font-size:50px;
				line-height:64px;
				
				top:60%;
				left:50%;
				
				color:#fff;
				font-family: sans-serif;
				transform: translate(-50%, 0%);
				z-index:100;		
				font-weight:bold;
				
				text-shadow: 2px 2px 2px black;
			}	
			
			
            canvas {
				  image-rendering: optimizeSpeed;
				  -webkit-interpolation-mode: nearest-neighbor;
				  -ms-touch-action: none;
				  margin: 0px;
				  padding: 0px;
				  border: 0px;
				  display:none;
            }
			
			#canvas, canvas {
				-webkit-tap-highlight-color: transparent;
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				-khtml-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}		

			@keyframes anim-pulse {
			  from { opacity: 1; }
			  50% { opacity: 0; }
			  to { opacity: 1; }
			}
			
			
            
            :-webkit-full-screen #canvas {
                 width: 100%;
                 height: 100%;
            }
			
            div.gm4html5_div_class {
              margin: 0px;
              padding: 0px;
              border: 0px;
			  with:100%;
			  height:100%;
            }
        </style>
    </head>

    <body id="body">

		
		<img id="decor" src="html5game/cook.png" alt=""/>	

		
		<div id="apples">
		<img id="apples-img" src="html5game/apples.png" alt=""/>
		</div> 
		
		<img id="decor-hands" src="html5game/cookhands.png" alt=""/>	
		
		<div class="piles" id="pile1">
			<div id="coin"></div>
		</div>		
		
		<div class="piles" id="pile2"></div>		
		<div class="piles" id="pile3"></div>		
		<div class="piles" id="pile4"></div>		
		
		<div id="bar"><div id="fill" class="pulsating"></div></div>
		<div id="proc">0%</div>
		
		<script>
		var proc		= document.getElementById("proc");
		var fakeCent	= 1;			
		var fakeCentTarget 	= 10;
		var fails			= 0;
		var lerpSpd 		= 0.02;
		var angle 		= 45;	

		var bodyLoad	= false;
		
		var apples 		= document.getElementById("apples");
		var img 		= document.getElementById("apples-img");
		var hands  		= document.getElementById("decor-hands");
		
		var fill 		= document.getElementById("fill");
		var coin 		= document.getElementById("coin");
		var piles 		= [];
		
		pile_add("pile1");
		pile_add("pile2");
		pile_add("pile3");
		pile_add("pile4");
		
		function pile_add(_id) {
			var _el = document.getElementById(_id);
			if (_el != undefined) {
				var _info = {};
				_info.pile = _el;
				_info.zIndex = 0;
				_info.yOff = -10;
				_info.count = 0;
				piles.push(_info);	
			}			
		}

        function loading_lerp (start, end, amt){
            return (1 - amt) * start + amt * end;
        }
		
		var intRotation = setInterval(function() {
			angle -= 0.5;
			img.style.transform = "rotate(" + angle + "deg)";

		}, 5);	

		var intGenerator = setInterval(function() {
			coin_add_to_random();
		}, 500);	
			

		function coin_add_to_random() {
			var _index = Math.floor(Math.random() * piles.length);
			coin_add_to_pile(piles[_index]);
		}
		
		function coin_add_to_pile(_info) {
			_info.count ++;
			if (_info.count < 20) {
				
				var _new = coin.cloneNode(true);			
				_info.zIndex++;
				_info.yOff += 20;
				
				var _odd = (_info.count % 2 == 1);
				var _xOff = 5;
				
				if (_odd) {
					_xOff += 10;
				}
				
				_new.style.display = "block";
				_new.style.zIndex = _info.zIndex;
				_new.style.bottom = _info.yOff + "px";
				_new.style.left = _xOff + "px";
				
				_info.pile.appendChild(_new);	
			}
		}
		
		for (var i = 0; i < 5; i++) {
			if (piles.length > 0) {
				coin_add_to_random();
			}
		}
	
		
		function bar_update(progress) {
			progress = Math.max(fakeCent, progress);
			fill.style.width = progress + "%";
			proc.innerHTML = Math.floor(progress) + "%"
		}			

		var fakeLoading = setInterval(function() {
			if (fakeCentTarget - fakeCent > 1) {
				fakeCent = loading_lerp(fakeCent, fakeCentTarget, lerpSpd);
			} else {
				if (fakeCentTarget < 70) {
					fakeCentTarget += 0.15;
				} else if (fakeCentTarget <= 98) {
					fakeCentTarget += 0.015;
				}
			}
			bar_update(fakeCent);
		}, 10);	
		
		
		</script>		
		
        <div class="gm4html5_div_class" id="gm4html5_div_id">
            <canvas id="canvas" width="100%" height="100%">
               <p>Your browser doesn't support HTML5 canvas.</p>
            </canvas>
			<script type="text/javascript" src="html5game/Cooking.js"></script>
        </div>


		<script>
		

		
		var sdk 		= PokiSDK;
		var pokiDebug 	= false;
		
        var canvas      = document.getElementById("canvas");
		var body 		= document.getElementById("body");
		var bar 		= document.getElementById("bar");
		var decor 		= document.getElementById("decor");		

		fill.classList.remove("pulsating");
		
		function poki_log(t) {
			console.log(t);
		}
            
        function poki_debug() {
            return pokiDebug;
        }
		
		function poki_loading(progress) {
			fakeCentTarget = Math.max(fakeCentTarget, (progress * 0.8) * 100);
			sdk.gameLoadingProgress({percentageDone: progress * 0.9});
			
			if (progress == 1) {
				fakeCentTarget = 100;
				fakeCent = 100;
				bar_update(100);	
				

				decor.style.display = "none";				
				proc.style.display = "none";	
				
				clearInterval(intRotation);					
				clearInterval(intGenerator);		

				for (var i = 0; i < piles.length; i++) {
					var _pile = piles[i];
					_pile.pile.remove();
				}
				
				hands.remove();
				apples.remove();
				
				piles = [];
								
				
				setTimeout(function () {
					canvas.style.display = "block";
                    clearInterval(fakeLoading);					
				}, 200);
			}
			bodyLoad = true;
		}
		

		

		
		
		function gamemaker_start() {
			try {
			  GameMaker_Init();
			} catch(err) {
				fails++;			
				setTimeout(gamemaker_start, 2000);
				if (fails == 1) throw(err);						
			}
		}

		//var bgScale = window.innerHeight / 1024;
		//body.style.backgroundSize = (512 * bgScale) + "px " + (1024 * bgScale) + "px";
		
		window.onload = function() {
			sdk.init().then(() => {
                setTimeout(gamemaker_start, 5);
                sdk.setDebug(pokiDebug);   
				sdk.gameLoadingStart();		
			}).catch(() => {
                gamemaker_start();
			});
        
            canvas.width  = window.innerWidth;
            canvas.height = window.innerHeight;
            canvas.addEventListener('click', function(){
                window.focus();
            });           
		}
		
		window.addEventListener('wheel', ev => ev.preventDefault(), { passive: false });
		window.addEventListener('keydown', ev => {
			if (['ArrowDown', 'ArrowUp', ' '].includes(ev.key)) {
				ev.preventDefault();
			}
		});		
            
                

		</script>
    </body>
</html>
